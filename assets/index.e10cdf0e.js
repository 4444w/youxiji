import{c as u,o as l,d as y,a,F as U,r as O,n as Z,t as G,b as Q,e as h,w as ee,v as te,s as p,f as j,g as ne,i as oe}from"./vendor.d5331d88.js";const se=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function c(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};se();var f=(e,t)=>{for(const[n,c]of t)e[n]=c;return e};const re={},ae={style:{display:"none"},id:"bg-music",preload:"auto",src:"media/bgm.mp3"};function ce(e,t){return l(),u("audio",ae)}var M=f(re,[["render",ce]]);const ie=y({data(){return{directions:["LEFT","RIGHT","UP","DOWN"]}},methods:{onButtonDown(e){const t=document.getElementById("joystick");if(!t)return;let n="X",c=8,o=!1;switch(e){case"UP":n="X",o=!1;break;case"DOWN":n="X",o=!0;break;case"LEFT":n="Y",o=!0;break;case"RIGHT":n="Y",o=!1}t.style.transform=`rotate${n}(${o?"-":""}${c}deg)`},onButtonUp(){const e=document.getElementById("joystick");e&&(e.style.transform="")}}}),ue={id:"joystick",class:"controller joystick"},le={id:"controls-direction"},de=["role","onMousedown","onTouchstart"];function _e(e,t,n,c,o,i){return l(),u("div",ue,[a("div",le,[(l(!0),u(U,null,O(e.directions,(s,d)=>(l(),u("button",{key:d,role:"BUTTON_"+s,class:Z(["joystick-btn",s.toLowerCase()]),onMousedown:m=>e.onButtonDown(s),onTouchstart:m=>e.onButtonDown(s),onMouseup:t[0]||(t[0]=(...m)=>e.onButtonUp&&e.onButtonUp(...m)),onTouchend:t[1]||(t[1]=(...m)=>e.onButtonUp&&e.onButtonUp(...m))},G(s),43,de))),128))])])}var R=f(ie,[["render",_e]]);const pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"1.2em",height:"1.2em",preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24"},me=a("path",{d:"M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z",fill:"currentColor"},null,-1),he=[me];function fe(e,t){return l(),u("svg",pe,he)}var ve={render:fe};const ge="fc",ye="0.1.0",$e="MIT",be={},Te={url:"https://www.yunyoujun.cn",email:"me@yunyoujun.cn",name:"YunYouJun"},Be={dev:"vite",build:"vite build",serve:"vite preview"},we={"@vitejs/plugin-vue":"^1.2.2","@vue/compiler-sfc":"^3.0.11",sass:"^1.34.0",typescript:"^4.3.2",vite:"^2.3.4","vite-plugin-components":"^0.10.2"},Ee={"@iconify/json":"^1.1.349",axios:"^0.21.1",jsnes:"^1.1.0","vite-plugin-icons":"^0.5.1",vue:"^3.0.11","vue-gtag":"^2.0.1"};var k={name:ge,version:ye,license:$e,repository:be,author:Te,scripts:Be,devDependencies:we,dependencies:Ee};const Ae=y({data(){return{githubUrl:k.repository.url}}}),Ce=["href"];function ke(e,t,n,c,o,i){const s=Q("icon-github"),d=ve;return l(),u("a",{class:"joy",href:e.githubUrl,target:"_blank"},[h(s),h(d)],8,Ce)}var I=f(Ae,[["render",ke]]);const Ue={},Ne=a("a",{href:"https://gitee.com/h4w/zl/raw/master/skm.jpg",target:"_blank",class:"readme"},"\u74DC\u5B50\u996E\u6599",-1),Fe=[Ne];function xe(e,t){return l(),u("div",null,Fe)}var P=f(Ue,[["render",xe]]),De=[{name:"\u8D85\u7EA7\u739B\u4E3D",path:"Super Mario Bros. (JU) (PRG0) [!].nes"},{name:"\u5192\u9669\u5C9B",path:"maoxiandao.nes"},{name:"\u9B42\u6597\u7F57",path:"hun.nes"},{name:"\u4E2D\u56FD\u8C61\u68CB",path:"Zhong Guo Xiang Qi.nes"},{name:"\u5766\u514B\u5927\u6218",path:"tanke.nes"},{name:"\u96EA\u4EBA\u5144\u5F1F",path:"xueren.nes"},{name:"\u8D8A\u91CE\u6469\u6258",path:"Motor.nes"},{name:"\u8D64\u5F71\u6218\u58EB",path:"Kage.nes"},{name:"\u70B8\u5F39\u4EBA",path:"zhadan.nes"},{name:"\u9A6C\u620F\u56E2",path:"ma.nes"},{name:"\u5F71\u5B50\u4F20\u8BF4",path:"Kage.nes"},{name:"\u6C99\u7F57\u66FC\u86C7",path:"life-force.nes"},{name:"\u53CC\u622A\u9F992",path:"Double Dragon2.nes"},{name:"\u8131\u72F1",path:"Cross Fire (J).nes"},{name:"\u529F\u592B",path:"(J) (V1.2) Yie Ar Kung-Fu [!].nes"},{name:"\u4E09\u76EE\u7AE5\u5B50",path:"3.nes"},{name:"\u6076\u9B54\u57CE1",path:"emc.nes"},{name:"\u6D1B\u514B\u4EBA1",path:"lkr.nes"},{name:"\u4EBA\u95F4\u5175\u5668",path:"rjbq.nes"},{name:"\u5FCD\u8005\u795E\u9F9F1",path:"sg1.nes"},{name:"\u6FC0\u9F9F\u5FEB\u6253",path:"sg4.nes"},{name:"\u6CE1\u6CE1\u9F992",path:"ppl2.nes"},{name:"\u897F\u6E38\u8BB01",path:"xyj.nes"},{name:"\u6DD8\u91D1\u8005",path:"Championship Lode Runner (J).nes"}];const Le=y({data(){return{currentGame:"default",romsList:De}},methods:{selectGame(){const e=this.currentGame;nesApp.load(e)}}}),Se={class:"nes-roms"},Oe=a("option",{disabled:"",selected:"",value:"default"},"\u9009\u62E9\u6E38\u620F...",-1),Ge={label:"\u7ECF\u5178"},je=["value"],Me=a("optgroup",{label:"\u672C\u9875\u9762\u7531\u516C\u4F17\u53F7(\u534E\u8DA3\u5B9E\u9A8C\u5BA4)\u63D0\u4F9B"},null,-1);function Re(e,t,n,c,o,i){return l(),u("div",Se,[ee(a("select",{class:"nes-select","onUpdate:modelValue":t[0]||(t[0]=s=>e.currentGame=s),onChange:t[1]||(t[1]=(...s)=>e.selectGame&&e.selectGame(...s))},[Oe,a("optgroup",Ge,[(l(!0),u(U,null,O(e.romsList,(s,d)=>(l(),u("option",{key:d,value:"roms/"+s.path},G(s.name),9,je))),128))]),Me],544),[[te,e.currentGame]])])}var q=f(Le,[["render",Re]]);const Ie={},Pe={class:"function"},qe=a("button",{class:"controls-center-select joy-btn",role:"BUTTON_SELECT"}," SELECT ",-1),Je=a("button",{class:"controls-center-start joy-btn",role:"BUTTON_START"}," START ",-1),He=[qe,Je];function Ye(e,t){return l(),u("div",Pe,He)}var J=f(Ie,[["render",Ye]]);const Ve=y({}),Xe={class:"action"},Ke=a("div",{id:"controls-fire"},[a("button",{class:"a joy-btn",role:"BUTTON_A"},"A"),a("button",{class:"b joy-btn",role:"BUTTON_B"},"B")],-1),We=[Ke];function ze(e,t,n,c,o,i){return l(),u("div",Xe,We)}var H=f(Ve,[["render",ze]]);const N=256,F=240,Ze=N*F;function Qe(e){const n=document.getElementById(e).getContext("2d");if(!n){console.log("\u753B\u5E03\u4E0D\u5B58\u5728");return}const c=n.getImageData(0,0,N,F);n.fillStyle="black",n.fillRect(0,0,N,F);const o=new ArrayBuffer(c.data.length),i=new Uint8ClampedArray(o),s=new Uint32Array(o),d=512,m=new window.AudioContext,w=m.createScriptProcessor(d,0,2);w.onaudioprocess=z,w.connect(m.destination);const $=4*1024,g=$-1,x=new Float32Array($),D=new Float32Array($);let b=0,E=0;const T=new p.NES({onFrame(_){for(let r=0;r<Ze;r++)s[r]=4278190080|_[r]},onAudioSample(_,r){x[b]=_,D[b]=r,b=b+1&g}});function L(){!n||(window.requestAnimationFrame(L),c.data.set(i),n.putImageData(c,0,0))}function W(){return b-E&g}function z(_){const r=_.outputBuffer,v=r.length;W()<d&&T.frame();let A=r.getChannelData(0),C=r.getChannelData(1);for(let B=0;B<v;B++){const S=E+B&g;A[B]=x[S],C[B]=D[S]}E=E+v&g}return{instance:T,bindButton(_){const r="BUTTON_"+_,v=document.querySelector(`[role="${r}"]`);if(!v)return;const A=()=>{T.buttonDown(1,p.Controller[r])},C=()=>{T.buttonUp(1,p.Controller[r])};v.ontouchstart=A,v.onmousedown=A,v.ontouchend=C,v.onmouseup=C},async load(_){const r=new XMLHttpRequest;return r.open("GET",_),r.overrideMimeType("text/plain; charset=x-user-defined"),r.onload=()=>{r.status===200?this.boot(r.responseText):r.status===0||console.log(`Error loading ${_}: ${r.statusText}`)},r.send(),r.responseText},boot(_){T.loadROM(_),window.requestAnimationFrame(L)}}}function Y(e,t){var n=1;switch(t.keyCode){case 38:e(n,p.Controller.BUTTON_UP);break;case 40:e(n,p.Controller.BUTTON_DOWN);break;case 37:e(n,p.Controller.BUTTON_LEFT);break;case 39:e(n,p.Controller.BUTTON_RIGHT);break;case 65:case 81:e(n,p.Controller.BUTTON_A);break;case 83:case 79:e(n,p.Controller.BUTTON_B);break;case 32:e(n,p.Controller.BUTTON_SELECT);break;case 13:e(n,p.Controller.BUTTON_START);break}}function et(e){document.addEventListener("keydown",t=>{Y(e.buttonDown,t)}),document.addEventListener("keyup",t=>{Y(e.buttonUp,t)})}const tt=y({components:{GameMenu:q,ControllerAction:H,ControllerFunction:J,ControllerJoystick:R,SponsorAdsense:P,GithubLink:I},mounted(){this.$nextTick(()=>{const e="roms/Super Mario Bros. (JU) (PRG0) [!].nes",t=Qe("nes-canvas");if(window.nesApp=t,!t){console.log("NES \u521D\u59CB\u5316\u5931\u8D25\uFF01");return}t.load(e),t.bindButton("LEFT"),t.bindButton("RIGHT"),t.bindButton("UP"),t.bindButton("DOWN"),t.bindButton("SELECT"),t.bindButton("START"),t.bindButton("A"),t.bindButton("B"),et(t.instance),document.querySelectorAll("button").forEach(n=>{n.addEventListener("contextmenu",c=>{c.preventDefault()})})})}}),nt={class:"main"},ot={class:"panel"},st={class:"controller-area"},rt={class:"function-area"},at={class:"screen"},ct={id:"emulator",style:{width:"100%",height:"100%"}},it=a("div",{style:{margin:"auto",width:"75%",height:"90%"}},[a("canvas",{id:"nes-canvas",width:"256",height:"240",style:{width:"100%"}})],-1),ut={class:"action-area"},lt=a("div",{class:"sign"},[j(" FAMILY "),a("br"),j(" COMPUTER ")],-1);function dt(e,t,n,c,o,i){const s=R,d=I,m=P,w=q,$=J,g=H;return l(),u("div",nt,[a("div",ot,[a("div",st,[h(s),h(d),h(m)]),a("div",rt,[a("div",at,[a("div",ct,[it,h(w)])]),h($)]),a("div",ut,[h(g)]),lt])])}var V=f(tt,[["render",dt]]);const _t=y({name:"App",components:{GamePad:V,GameBgm:M}});function pt(e,t,n,c,o,i){const s=M,d=V;return l(),u(U,null,[h(s),h(d)],64)}var mt=f(_t,[["render",pt]]);function X(e,t,n,c){n||(n="#0078E7"),console.log(`%c ${c||"\u2601\uFE0F"} ${e} %c ${t}`,`color: white; background: ${n}; padding:5px 0;`,`padding:4px;border:1px solid ${n};`)}function ht(){X("fc",k.repository.url,"#DA4A4A","\u{1F3AE}"),X("@"+k.author.name,k.repository.url)}const K=ne(mt);K.use(oe,{config:{id:"G-XMGX6YJVP8"}});K.mount("#app");ht();
